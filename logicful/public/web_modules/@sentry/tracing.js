import{g as O,E as y,l as c,b as u,t as T,Q as C,e as D,_ as S,M as E,O as M,R as B,T as z,U as G,V as Y,W as X,A as x,X as J,Y as K,c as $,m as A}from"../common/hub-e5e7c94b.js";var p;(function(e){e.Ok="ok",e.DeadlineExceeded="deadline_exceeded",e.Unauthenticated="unauthenticated",e.PermissionDenied="permission_denied",e.NotFound="not_found",e.ResourceExhausted="resource_exhausted",e.InvalidArgument="invalid_argument",e.Unimplemented="unimplemented",e.Unavailable="unavailable",e.InternalError="internal_error",e.UnknownError="unknown_error",e.Cancelled="cancelled",e.AlreadyExists="already_exists",e.FailedPrecondition="failed_precondition",e.Aborted="aborted",e.OutOfRange="out_of_range",e.DataLoss="data_loss"})(p||(p={})),function(e){function t(i){if(i<400)return e.Ok;if(i>=400&&i<500)switch(i){case 401:return e.Unauthenticated;case 403:return e.PermissionDenied;case 404:return e.NotFound;case 409:return e.AlreadyExists;case 413:return e.FailedPrecondition;case 429:return e.ResourceExhausted;default:return e.InvalidArgument}if(i>=500&&i<600)switch(i){case 501:return e.Unimplemented;case 503:return e.Unavailable;case 504:return e.DeadlineExceeded;default:return e.InternalError}return e.UnknownError}e.fromHttpCode=t}(p||(p={}));var V=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function Q(e){return"tracesSampleRate"in e||"tracesSampler"in e}function Z(e){var t=e.match(V);if(t){var i=void 0;return t[3]==="1"?i=!0:t[3]==="0"&&(i=!1),{traceId:t[1],parentSampled:i,parentSpanId:t[2]}}return}function k(e){e===void 0&&(e=O());var t,i;return(i=(t=e)===null||t===void 0?void 0:t.getScope())===null||i===void 0?void 0:i.getTransaction()}function f(e){return e/1e3}function ee(e){return e*1e3}function te(){y({callback:N,type:"error"}),y({callback:N,type:"unhandledrejection"})}function N(){var e=k();e&&(c.log("[Tracing] Transaction: "+p.InternalError+" -> Global error occured"),e.setStatus(p.InternalError))}var q=function(){function e(t){t===void 0&&(t=1e3),this.spans=[],this._maxlen=t}return e.prototype.add=function(t){this.spans.length>this._maxlen?t.spanRecorder=void 0:this.spans.push(t)},e}(),ie=function(){function e(t){if(this.traceId=D(),this.spanId=D().substring(16),this.startTimestamp=T(),this.tags={},this.data={},!t)return this;t.traceId&&(this.traceId=t.traceId),t.spanId&&(this.spanId=t.spanId),t.parentSpanId&&(this.parentSpanId=t.parentSpanId),"sampled"in t&&(this.sampled=t.sampled),t.op&&(this.op=t.op),t.description&&(this.description=t.description),t.data&&(this.data=t.data),t.tags&&(this.tags=t.tags),t.status&&(this.status=t.status),t.startTimestamp&&(this.startTimestamp=t.startTimestamp),t.endTimestamp&&(this.endTimestamp=t.endTimestamp)}return e.prototype.child=function(t){return this.startChild(t)},e.prototype.startChild=function(t){var i=new e(u(u({},t),{parentSpanId:this.spanId,sampled:this.sampled,traceId:this.traceId}));return i.spanRecorder=this.spanRecorder,i.spanRecorder&&i.spanRecorder.add(i),i},e.prototype.setTag=function(t,i){var n;return this.tags=u(u({},this.tags),(n={},n[t]=i,n)),this},e.prototype.setData=function(t,i){var n;return this.data=u(u({},this.data),(n={},n[t]=i,n)),this},e.prototype.setStatus=function(t){return this.status=t,this},e.prototype.setHttpStatus=function(t){this.setTag("http.status_code",String(t));var i=p.fromHttpCode(t);return i!==p.UnknownError&&this.setStatus(i),this},e.prototype.isSuccess=function(){return this.status===p.Ok},e.prototype.finish=function(t){this.endTimestamp=typeof t=="number"?t:T()},e.prototype.toTraceparent=function(){var t="";return this.sampled!==void 0&&(t=this.sampled?"-1":"-0"),this.traceId+"-"+this.spanId+t},e.prototype.getTraceContext=function(){return C({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,trace_id:this.traceId})},e.prototype.toJSON=function(){return C({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,start_timestamp:this.startTimestamp,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this.endTimestamp,trace_id:this.traceId})},e}(),H=function(e){S(t,e);function t(i,n){var a=e.call(this,i)||this;return a._hub=O(),E(n,M)&&(a._hub=n),i.name&&(a.name=i.name),a._trimEnd=i.trimEnd,a}return t.prototype.setName=function(i){this.name=i},t.prototype.initSpanRecorder=function(i){i===void 0&&(i=1e3),this.spanRecorder||(this.spanRecorder=new q(i)),this.spanRecorder.add(this)},t.prototype.finish=function(i){var n=this;if(this.endTimestamp!==void 0)return;if(this.name||(c.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this.name="<unlabeled transaction>"),e.prototype.finish.call(this,i),this.sampled!==!0){c.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled.");return}var a=this.spanRecorder?this.spanRecorder.spans.filter(function(r){return r!==n&&r.endTimestamp}):[];return this._trimEnd&&a.length>0&&(this.endTimestamp=a.reduce(function(r,s){return r.endTimestamp&&s.endTimestamp?r.endTimestamp>s.endTimestamp?r:s:r}).endTimestamp),this._hub.captureEvent({contexts:{trace:this.getTraceContext()},spans:a,start_timestamp:this.startTimestamp,tags:this.tags,timestamp:this.endTimestamp,transaction:this.name,type:"transaction"})},t}(ie),P=1e3,ne=function(e){S(t,e);function t(i,n,a,r){a===void 0&&(a="");var s=e.call(this,r)||this;return s._pushActivity=i,s._popActivity=n,s.transactionSpanId=a,s}return t.prototype.add=function(i){var n=this;i.spanId!==this.transactionSpanId&&(i.finish=function(a){i.endTimestamp=typeof a=="number"?a:T(),n._popActivity(i.spanId)},i.endTimestamp===void 0&&this._pushActivity(i.spanId)),e.prototype.add.call(this,i)},t}(q),ae=function(e){S(t,e);function t(i,n,a,r){a===void 0&&(a=P),r===void 0&&(r=!1);var s=e.call(this,i,n)||this;return s._idleHub=n,s._idleTimeout=a,s._onScope=r,s.activities={},s._heartbeatTimer=0,s._heartbeatCounter=0,s._finished=!1,s._beforeFinishCallbacks=[],n&&r&&(F(n),c.log("Setting idle transaction on scope. Span ID: "+s.spanId),n.configureScope(function(o){return o.setSpan(s)})),s}return t.prototype.finish=function(i){var n,a,r=this;if(i===void 0&&(i=T()),this._finished=!0,this.activities={},this.spanRecorder){c.log("[Tracing] finishing IdleTransaction",new Date(i*1e3).toISOString(),this.op);try{for(var s=B(this._beforeFinishCallbacks),o=s.next();!o.done;o=s.next()){var d=o.value;d(this,i)}}catch(h){n={error:h}}finally{try{o&&!o.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}this.spanRecorder.spans=this.spanRecorder.spans.filter(function(h){if(h.spanId===r.spanId)return!0;h.endTimestamp||(h.endTimestamp=i,h.setStatus(p.Cancelled),c.log("[Tracing] cancelling span since transaction ended early",JSON.stringify(h,void 0,2)));var l=h.startTimestamp<i;return l||c.log("[Tracing] discarding Span since it happened after Transaction was finished",JSON.stringify(h,void 0,2)),l}),this._onScope&&F(this._idleHub),c.log("[Tracing] flushing IdleTransaction")}else c.log("[Tracing] No active IdleTransaction");return e.prototype.finish.call(this,i)},t.prototype.registerBeforeFinishCallback=function(i){this._beforeFinishCallbacks.push(i)},t.prototype.initSpanRecorder=function(i){var n=this;if(!this.spanRecorder){this._initTimeout=setTimeout(function(){n._finished||n.finish()},this._idleTimeout);var a=function(s){if(n._finished)return;n._pushActivity(s)},r=function(s){if(n._finished)return;n._popActivity(s)};this.spanRecorder=new ne(a,r,this.spanId,i),c.log("Starting heartbeat"),this._pingHeartbeat()}this.spanRecorder.add(this)},t.prototype._pushActivity=function(i){this._initTimeout&&(clearTimeout(this._initTimeout),this._initTimeout=void 0),c.log("[Tracing] pushActivity: "+i),this.activities[i]=!0,c.log("[Tracing] new activities count",Object.keys(this.activities).length)},t.prototype._popActivity=function(i){var n=this;if(this.activities[i]&&(c.log("[Tracing] popActivity "+i),delete this.activities[i],c.log("[Tracing] new activities count",Object.keys(this.activities).length)),Object.keys(this.activities).length===0){var a=this._idleTimeout,r=T()+a/1e3;setTimeout(function(){n._finished||n.finish(r)},a)}},t.prototype._beat=function(){if(clearTimeout(this._heartbeatTimer),this._finished)return;var i=Object.keys(this.activities),n=i.length?i.reduce(function(a,r){return a+r}):"";n===this._prevHeartbeatString?this._heartbeatCounter+=1:this._heartbeatCounter=1,this._prevHeartbeatString=n,this._heartbeatCounter>=3?(c.log("[Tracing] Transaction finished because of no change for 3 heart beats"),this.setStatus(p.DeadlineExceeded),this.setTag("heartbeat","failed"),this.finish()):this._pingHeartbeat()},t.prototype._pingHeartbeat=function(){var i=this;c.log("pinging Heartbeat -> current counter: "+this._heartbeatCounter),this._heartbeatTimer=setTimeout(function(){i._beat()},5e3)},t}(H);function F(e){if(e){var t=e.getScope();if(t){var i=t.getTransaction();i&&t.setSpan(void 0)}}}function re(){var e=this.getScope();if(e){var t=e.getSpan();if(t)return{"sentry-trace":t.toTraceparent()}}return{}}function se(e,t){return e!==void 0?e:t}function j(e,t,i){var n,a=e.getClient(),r=a&&a.getOptions()||{};if(!a||!Q(r))return t.sampled=!1,t;var s=typeof r.tracesSampler=="function"?r.tracesSampler(i):se(i.parentSampled,r.tracesSampleRate);return oe(s)?s?(t.sampled=Math.random()<s,t.sampled?(t.initSpanRecorder((n=r._experiments)===null||n===void 0?void 0:n.maxSpans),c.log("[Tracing] starting "+t.op+" transaction - "+t.name),t):(c.log("[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = "+Number(s)+")"),t)):(c.log("[Tracing] Discarding transaction because "+(typeof r.tracesSampler=="function"?"tracesSampler returned 0 or false":"tracesSampleRate is set to 0")),t.sampled=!1,t):(c.warn("[Tracing] Discarding transaction because of invalid sample rate."),t.sampled=!1,t)}function U(e){var t=e.parentSampled,i={transactionContext:e,parentSampled:t};if(z()){var n=G();if(n){var a=Y(module,"http"),r=a.IncomingMessage,s=n.members.find(function(d){return E(d,r)});s&&(i.request=X(s))}}else{var o=x();"location"in o&&(i.location=u({},o.location))}return i}function oe(e){return isNaN(e)||!(typeof e=="number"||typeof e=="boolean")?(c.warn("[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got "+JSON.stringify(e)+" of type "+JSON.stringify(typeof e)+"."),!1):e<0||e>1?(c.warn("[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got "+e+"."),!1):!0}function ce(e,t){var i=new H(e,this);return j(this,i,u(u({},U(e)),t))}function de(e,t,i,n){var a=new ae(t,e,i,n);return j(e,a,U(t))}function ue(){var e=J();e.__SENTRY__&&(e.__SENTRY__.extensions=e.__SENTRY__.extensions||{},e.__SENTRY__.extensions.startTransaction||(e.__SENTRY__.extensions.startTransaction=ce),e.__SENTRY__.extensions.traceHeaders||(e.__SENTRY__.extensions.traceHeaders=re))}function le(){ue(),te()}var I=x();function he(){I&&I.document?I.document.addEventListener("visibilitychange",function(){var e=k();I.document.hidden&&e&&(c.log("[Tracing] Transaction: "+p.Cancelled+" -> since tab moved to the background, op: "+e.op),e.status||e.setStatus(p.Cancelled),e.setTag("visibilitychange","document.hidden"),e.finish())}):c.warn("[Tracing] Could not set up background tab detection due to lack of global document")}var m=x(),pe=function(){function e(){this._lcp={},this._performanceCursor=0,this._forceLCP=function(){return},m&&m.performance&&(m.performance.mark&&m.performance.mark("sentry-tracing-init"),this._trackLCP())}return e.prototype.addPerformanceEntries=function(t){if(!m||!m.performance||!m.performance.getEntries)return;c.log("[Tracing] Adding & adjusting spans using Performance API"),t.op==="pageload"&&(this._forceLCP(),this._lcp&&t.setData("_sentry_web_vitals",{LCP:this._lcp}));var i=f(performance.timeOrigin),n;if(m.document){for(var a=0;a<document.scripts.length;a++)if(document.scripts[a].dataset.entry==="true"){n=document.scripts[a].src;break}}var r,s;m.performance.getEntries().slice(this._performanceCursor).forEach(function(o){var d=f(o.startTime),h=f(o.duration);if(t.op==="navigation"&&i+d<t.startTimestamp)return;switch(o.entryType){case"navigation":fe(t,o,i);break;case"mark":case"paint":case"measure":{var l=me(t,o,d,h,i);s===void 0&&o.name==="sentry-tracing-init"&&(s=l);break}case"resource":{var g=o.name.replace(window.location.origin,""),b=ge(t,o,g,d,h,i);r===void 0&&(n||"").indexOf(g)>-1&&(r=b);break}}}),r!==void 0&&s!==void 0&&v(t,{description:"evaluation",endTimestamp:s,op:"script",startTimestamp:r}),this._performanceCursor=Math.max(performance.getEntries().length-1,0)},e.prototype._trackLCP=function(){var t=this;try{var i=document.visibilityState==="hidden"?0:Infinity;document.addEventListener("visibilitychange",function(r){i=Math.min(i,r.timeStamp)},{once:!0});var n=function(r){r.startTime<i&&(t._lcp=u(u(u({},r.id&&{elementId:r.id}),r.size&&{elementSize:r.size}),{value:r.startTime}))},a=new PerformanceObserver(function(r){r.getEntries().forEach(n)});a.observe({buffered:!0,type:"largest-contentful-paint"}),this._forceLCP=function(){a.takeRecords&&a.takeRecords().forEach(n)}}catch(r){}},e}();function fe(e,t,i){_(e,t,"unloadEvent",i),_(e,t,"domContentLoadedEvent",i),_(e,t,"loadEvent",i),_(e,t,"connect",i),_(e,t,"domainLookup",i),ve(e,t,i)}function me(e,t,i,n,a){var r=a+i,s=r+n;return v(e,{description:t.name,endTimestamp:s,op:t.entryType,startTimestamp:r}),r}function ge(e,t,i,n,a,r){if(t.initiatorType==="xmlhttprequest"||t.initiatorType==="fetch")return;var s={};"transferSize"in t&&(s["Transfer Size"]=t.transferSize),"encodedBodySize"in t&&(s["Encoded Body Size"]=t.encodedBodySize),"decodedBodySize"in t&&(s["Decoded Body Size"]=t.decodedBodySize);var o=r+n,d=o+a;return v(e,{description:i,endTimestamp:d,op:t.initiatorType?"resource."+t.initiatorType:"resource",startTimestamp:o,data:s}),d}function _(e,t,i,n){var a=t[i+"End"],r=t[i+"Start"];if(!r||!a)return;v(e,{description:i,endTimestamp:n+f(a),op:"browser",startTimestamp:n+f(r)})}function ve(e,t,i){v(e,{description:"request",endTimestamp:i+f(t.responseEnd),op:"browser",startTimestamp:i+f(t.requestStart)}),v(e,{description:"response",endTimestamp:i+f(t.responseEnd),op:"browser",startTimestamp:i+f(t.responseStart)})}function v(e,t){var i=t.startTimestamp,n=K(t,["startTimestamp"]);return i&&e.startTimestamp>i&&(e.startTimestamp=i),e.startChild(u({startTimestamp:i},n))}var be=["localhost",/^\//],R={traceFetch:!0,traceXHR:!0,tracingOrigins:be};function ye(e){var t=u(u({},R),e),i=t.traceFetch,n=t.traceXHR,a=t.tracingOrigins,r=t.shouldCreateSpanForRequest,s={},o=function(l){if(s[l])return s[l];var g=a;return s[l]=g.some(function(b){return A(l,b)})&&!A(l,"sentry_key"),s[l]},d=o;typeof r=="function"&&(d=function(l){return o(l)&&r(l)});var h={};i&&y({callback:function(l){Te(l,d,h)},type:"fetch"}),n&&y({callback:function(l){_e(l,d,h)},type:"xhr"})}function Te(e,t,i){if(!e.fetchData||!t(e.fetchData.url))return;if(e.endTimestamp&&e.fetchData.__span){var n=i[e.fetchData.__span];if(n){var a=e.response;a&&n.setHttpStatus(a.status),n.finish(),delete i[e.fetchData.__span]}return}var r=k();if(r){var n=r.startChild({data:u(u({},e.fetchData),{type:"fetch"}),description:e.fetchData.method+" "+e.fetchData.url,op:"http"});e.fetchData.__span=n.spanId,i[n.spanId]=n;var s=e.args[0]=e.args[0],o=e.args[1]=e.args[1]||{},d=o.headers;E(s,Request)&&(d=s.headers),d?typeof d.append=="function"?d.append("sentry-trace",n.toTraceparent()):Array.isArray(d)?d=$(d,[["sentry-trace",n.toTraceparent()]]):d=u(u({},d),{"sentry-trace":n.toTraceparent()}):d={"sentry-trace":n.toTraceparent()},o.headers=d}}function _e(e,t,i){if(!e||!e.xhr||!e.xhr.__sentry_xhr__)return;var n=e.xhr.__sentry_xhr__;if(!t(n.url))return;if(e.xhr.__sentry_own_request__)return;if(e.endTimestamp&&e.xhr.__sentry_xhr_span_id__){var a=i[e.xhr.__sentry_xhr_span_id__];a&&(a.setData("url",n.url),a.setData("method",n.method),a.setHttpStatus(n.status_code),a.finish(),delete i[e.xhr.__sentry_xhr_span_id__]);return}var r=k();if(r){var a=r.startChild({data:u(u({},n.data),{type:"xhr"}),description:n.method+" "+n.url,op:"http"});if(e.xhr.__sentry_xhr_span_id__=a.spanId,i[e.xhr.__sentry_xhr_span_id__]=a,e.xhr.setRequestHeader)try{e.xhr.setRequestHeader("sentry-trace",a.toTraceparent())}catch(o){}}}var w=x();function we(e,t,i){if(t===void 0&&(t=!0),i===void 0&&(i=!0),!w||!w.location){c.warn("Could not initialize routing instrumentation due to invalid location");return}var n=w.location.href,a;t&&(a=e({name:w.location.pathname,op:"pageload"})),i&&y({callback:function(r){var s=r.to,o=r.from;if(o===void 0&&n&&n.indexOf(s)!==-1){n=void 0;return}o!==s&&(n=void 0,a&&(c.log("[Tracing] Finishing current transaction with op: "+a.op),a.finish()),a=e({name:w.location.pathname,op:"navigation"}))},type:"history"})}function xe(e){return e}var ke=600,Ie=u({beforeNavigate:xe,idleTimeout:P,markBackgroundTransactions:!0,maxTransactionDuration:ke,routingInstrumentation:we,startTransactionOnLocationChange:!0,startTransactionOnPageLoad:!0},R),Re=function(){function e(t){this.name=e.id,this._metrics=new pe,this._emitOptionsWarning=!1;var i=R.tracingOrigins;t&&t.tracingOrigins&&Array.isArray(t.tracingOrigins)&&t.tracingOrigins.length!==0?i=t.tracingOrigins:this._emitOptionsWarning=!0,this.options=u(u(u({},Ie),t),{tracingOrigins:i})}return e.prototype.setupOnce=function(t,i){var n=this;this._getCurrentHub=i,this._emitOptionsWarning&&(c.warn("[Tracing] You need to define `tracingOrigins` in the options. Set an array of urls or patterns to trace."),c.warn("[Tracing] We added a reasonable default for you: "+R.tracingOrigins));var a=this.options,r=a.routingInstrumentation,s=a.startTransactionOnLocationChange,o=a.startTransactionOnPageLoad,d=a.markBackgroundTransactions,h=a.traceFetch,l=a.traceXHR,g=a.tracingOrigins,b=a.shouldCreateSpanForRequest;r(function(L){return n._createRouteTransaction(L)},o,s),d&&he(),ye({traceFetch:h,traceXHR:l,tracingOrigins:g,shouldCreateSpanForRequest:b})},e.prototype._createRouteTransaction=function(t){var i=this;if(!this._getCurrentHub){c.warn("[Tracing] Did not create "+t.op+" transaction because _getCurrentHub is invalid.");return}var n=this.options,a=n.beforeNavigate,r=n.idleTimeout,s=n.maxTransactionDuration,o=a(u(u(u({},t),Se()),{trimEnd:!0}));if(o===void 0){c.log("[Tracing] Did not create "+t.op+" idleTransaction due to beforeNavigate");return}var d=this._getCurrentHub();c.log("[Tracing] starting "+o.op+" idleTransaction on scope");var h=de(d,o,r,!0);return h.registerBeforeFinishCallback(function(l,g){i._metrics.addPerformanceEntries(l),Oe(ee(s),l,g)}),h},e.id="BrowserTracing",e}();function Se(){var e=Ee("sentry-trace");return e?Z(e):void 0}function Ee(e){var t=document.querySelector("meta[name="+e+"]");return t?t.getAttribute("content"):null}function Oe(e,t,i){var n=i-t.startTimestamp,a=i&&(n>e||n<0);a&&(t.setStatus(p.DeadlineExceeded),t.setTag("maxTransactionDurationExceeded","true"))}var Ce=function(){function e(t){t===void 0&&(t={}),this.name=e.id,this._app=t.app}return e.prototype.setupOnce=function(){if(!this._app){c.error("ExpressIntegration is missing an Express instance");return}Ae(this._app)},e.id="Express",e}();function W(e){var t=e.length;switch(t){case 2:return function(i,n){var a=n.__sentry_transaction;if(a){var r=a.startChild({description:e.name,op:"middleware"});n.once("finish",function(){r.finish()})}return e.apply(this,arguments)};case 3:return function(i,n,a){var r=n.__sentry_transaction,s=r&&r.startChild({description:e.name,op:"middleware"});e.call(this,i,n,function(){return s&&s.finish(),a.apply(this,arguments)})};case 4:return function(i,n,a,r){var s=a.__sentry_transaction,o=s&&s.startChild({description:e.name,op:"middleware"});e.call(this,i,n,a,function(){return o&&o.finish(),r.apply(this,arguments)})};default:throw new Error("Express middleware takes 2-4 arguments. Got: "+t)}}function De(e){return Array.from(e).map(function(t){return typeof t=="function"?W(t):Array.isArray(t)?t.map(function(i){return typeof i=="function"?W(i):i}):t})}function Ae(e){var t=e.use;return e.use=function(){return t.apply(this,De(arguments))},e}var Ne=Object.freeze({__proto__:null,Express:Ce}),qe=u(u({},Ne),{BrowserTracing:Re});le();export{qe as Integrations};
