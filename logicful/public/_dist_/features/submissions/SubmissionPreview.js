import{SvelteComponent as Se,add_render_callback as we,append as a,attr as ie,check_outros as Z,create_bidirectional_transition as fe,create_component as le,destroy_component as se,destroy_each as ye,detach as g,element as k,empty as ne,group_outros as x,init as he,insert as S,listen as je,mount_component as oe,noop as De,outro_and_destroy_block as Fe,prevent_default as Le,safe_not_equal as Pe,set_data as I,space as h,text as B,transition_in as L,transition_out as $,update_keyed_each as Ce}from"../../../web_modules/svelte/internal.js";import{isObject as $e}from"../../guards/Guard.js";import ue from"../form/live/LiveField.js";import{subscribeFieldChange as Oe}from"../../event/FieldEvent.js";import{LogicBuilder as Ne}from"../../services/LogicBuilder.js";import{fastClone as ee}from"../../util/Compare.js";import{afterUpdate as Be,onMount as me}from"../../../web_modules/svelte.js";import{submitForm as Ae}from"../form/live/service/SubmitForm.js";import{LoadState as Q}from"../../models/LoadState.js";import{fade as ae}from"../../../web_modules/svelte/transition.js";import{subscribeComponent as de}from"../../event/EventBus.js";import{formatSubmissionItem as Re}from"../../pages/form/FormSubmissionsPage.js";import Ie from"../../components/Loader.js";import{postApi as Je}from"../../services/ApiService.js";import ce from"../../components/Button.js";function _e(n,e,t){const s=n.slice();return s[18]=e[t],s}function be(n,e,t){const s=n.slice();return s[21]=e[t],s}function Ee(n){let e,t,s,l=(n[0].title??"Form Title")+"",o,f,b,u=(n[0].description??"")+"",_,D,p,d,c=[],O=new Map,N,j,J,H,G,z,m,v,F,P,E,R,V,K,W,U,M,A,X,C=n[1]&&pe(n),q=n[0].fields;const Y=i=>i[21].id;for(let i=0;i<q.length;i+=1){let r=be(n,q,i),w=Y(r);O.set(w,c[i]=ve(w,r))}let T=Object.keys(n[1]?.details??[]).filter(n[12]),y=[];for(let i=0;i<T.length;i+=1)y[i]=ge(_e(n,T,i));const te=i=>$(y[i],1,1,()=>{y[i]=null});return{c(){C&&C.c(),e=h(),t=k("div"),s=k("h4"),o=B(l),f=h(),b=k("small"),_=B(u),D=h(),p=k("form"),d=k("div");for(let i=0;i<c.length;i+=1)c[i].c();N=h(),j=k("div"),J=k("h4"),J.innerHTML="<strong>Raw Details</strong>",H=h(),G=k("hr"),z=h();for(let i=0;i<y.length;i+=1)y[i].c();m=h(),v=k("br"),F=h(),P=k("h4"),P.innerHTML="<strong>Raw JSON</strong>",E=h(),R=k("hr"),V=h(),K=k("div"),W=k("pre"),U=k("code"),U.textContent=`${n[8]()}`,ie(b,"class","text-gray-700"),ie(t,"class","mt-5"),ie(K,"class","mt-4"),ie(j,"class","mt-4")},m(i,r){C&&C.m(i,r),S(i,e,r),S(i,t,r),a(t,s),a(s,o),a(t,f),a(t,b),a(b,_),S(i,D,r),S(i,p,r),a(p,d);for(let w=0;w<c.length;w+=1)c[w].m(d,null);S(i,N,r),S(i,j,r),a(j,J),a(j,H),a(j,G),a(j,z);for(let w=0;w<y.length;w+=1)y[w].m(j,null);a(j,m),a(j,v),a(j,F),a(j,P),a(j,E),a(j,R),a(j,V),a(j,K),a(K,W),a(W,U),M=!0,A||(X=je(p,"submit",Le(n[10])),A=!0)},p(i,r){if(i[1]?C?C.p(i,r):(C=pe(i),C.c(),C.m(e.parentNode,e)):C&&(C.d(1),C=null),(!M||r&1)&&l!==(l=(i[0].title??"Form Title")+"")&&I(o,l),(!M||r&1)&&u!==(u=(i[0].description??"")+"")&&I(_,u),r&513){const w=i[0].fields;x(),c=Ce(c,r,Y,1,i,w,O,d,Fe,ve,null,be),Z()}if(r&246){T=Object.keys(i[1]?.details??[]).filter(i[12]);let w;for(w=0;w<T.length;w+=1){const re=_e(i,T,w);y[w]?(y[w].p(re,r),L(y[w],1)):(y[w]=ge(re),y[w].c(),L(y[w],1),y[w].m(j,m))}for(x(),w=T.length;w<y.length;w+=1)te(w);Z()}},i(i){if(M)return;for(let r=0;r<q.length;r+=1)L(c[r]);for(let r=0;r<T.length;r+=1)L(y[r]);M=!0},o(i){for(let r=0;r<c.length;r+=1)$(c[r]);y=y.filter(Boolean);for(let r=0;r<y.length;r+=1)$(y[r]);M=!1},d(i){C&&C.d(i),i&&g(e),i&&g(t),i&&g(D),i&&g(p);for(let r=0;r<c.length;r+=1)c[r].d();i&&g(N),i&&g(j),ye(y,i),A=!1,X()}}}function Me(n){let e,t;return e=new Ie({}),{c(){le(e.$$.fragment)},m(s,l){oe(e,s,l),t=!0},p:De,i(s){if(t)return;L(e.$$.fragment,s),t=!0},o(s){$(e.$$.fragment,s),t=!1},d(s){se(e,s)}}}function pe(n){let e,t,s,l=n[7]("Submission Date")+"",o,f,b,u,_,D,p,d=n[1].meta?.ipAddress+"",c,O,N,j,J=n[1].meta?.env?.browser?.name+"",H,G,z=n[1].meta?.env?.browser?.version+"",m,v,F,P,E,R=n[1].meta?.env?.os?.name+"",V,K,W=(n[1].meta?.env?.os?.versionName??n[1].meta?.env?.os?.version)+"",U,M,A,X,C,q=n[1].meta?.env?.platform?.vendor+"",Y,T,y=n[1].meta?.env?.platform?.type+"",te;return{c(){e=k("p"),t=k("strong"),t.textContent="Submission Date:",s=h(),o=B(l),f=h(),b=k("br"),u=h(),_=k("h4"),_.innerHTML="<strong>Environment Information</strong>",D=h(),p=k("strong"),p.textContent="Ip Address: ",c=B(d),O=h(),N=k("p"),j=k("strong"),j.textContent="Browser: ",H=B(J),G=h(),m=B(z),v=h(),F=k("p"),P=k("strong"),P.textContent="OS:",E=h(),V=B(R),K=h(),U=B(W),M=h(),A=k("p"),X=k("strong"),X.textContent="Platform:",C=h(),Y=B(q),T=h(),te=B(y)},m(i,r){S(i,e,r),a(e,t),a(e,s),a(e,o),S(i,f,r),S(i,b,r),S(i,u,r),S(i,_,r),S(i,D,r),S(i,p,r),S(i,c,r),S(i,O,r),S(i,N,r),a(N,j),a(N,H),a(N,G),a(N,m),S(i,v,r),S(i,F,r),a(F,P),a(F,E),a(F,V),a(F,K),a(F,U),S(i,M,r),S(i,A,r),a(A,X),a(A,C),a(A,Y),a(A,T),a(A,te)},p(i,r){r&2&&d!==(d=i[1].meta?.ipAddress+"")&&I(c,d),r&2&&J!==(J=i[1].meta?.env?.browser?.name+"")&&I(H,J),r&2&&z!==(z=i[1].meta?.env?.browser?.version+"")&&I(m,z),r&2&&R!==(R=i[1].meta?.env?.os?.name+"")&&I(V,R),r&2&&W!==(W=(i[1].meta?.env?.os?.versionName??i[1].meta?.env?.os?.version)+"")&&I(U,W),r&2&&q!==(q=i[1].meta?.env?.platform?.vendor+"")&&I(Y,q),r&2&&y!==(y=i[1].meta?.env?.platform?.type+"")&&I(te,y)},d(i){i&&g(e),i&&g(f),i&&g(b),i&&g(u),i&&g(_),i&&g(D),i&&g(p),i&&g(c),i&&g(O),i&&g(N),i&&g(v),i&&g(F),i&&g(M),i&&g(A)}}}function Te(n){let e,t,s,l;return t=new ue({props:{field:ee(n[21]),hidden:!0}}),{c(){e=k("div"),le(t.$$.fragment),s=h()},m(o,f){S(o,e,f),oe(t,e,null),a(e,s),l=!0},p(o,f){const b={};f&1&&(b.field=ee(o[21])),t.$set(b)},i(o){if(l)return;L(t.$$.fragment,o),l=!0},o(o){$(t.$$.fragment,o),l=!1},d(o){o&&g(e),se(t)}}}function ze(n){let e,t,s,l,o;return t=new ue({props:{field:ee(n[21])}}),{c(){e=k("div"),le(t.$$.fragment),s=h()},m(f,b){S(f,e,b),oe(t,e,null),a(e,s),o=!0},p(f,b){const u={};b&1&&(u.field=ee(f[21])),t.$set(u)},i(f){if(o)return;L(t.$$.fragment,f),we(()=>{l||(l=fe(e,ae,{},!0)),l.run(1)}),o=!0},o(f){$(t.$$.fragment,f),l||(l=fe(e,ae,{},!1)),l.run(0),o=!1},d(f){f&&g(e),se(t),f&&l&&l.end()}}}function ve(n,e){let t,s,l,o,f,b;const u=[ze,Te],_=[];function D(p,d){return d&1&&(s=!!p[9](p[21])),s?0:1}return l=D(e,-1),o=_[l]=u[l](e),{key:n,first:null,c(){t=ne(),o.c(),f=ne(),this.first=t},m(p,d){S(p,t,d),_[l].m(p,d),S(p,f,d),b=!0},p(p,d){let c=l;l=D(p,d),l===c?_[l].p(p,d):(x(),$(_[c],1,1,()=>{_[c]=null}),Z(),o=_[l],o||(o=_[l]=u[l](p),o.c()),L(o,1),o.m(f.parentNode,f))},i(p){if(b)return;L(o),b=!0},o(p){$(o),b=!1},d(p){p&&g(t),_[l].d(p),p&&g(f)}}}function ke(n){let e,t,s,l;const o=[We,He],f=[];function b(u,_){return u[4]?1:0}return e=b(n,-1),t=f[e]=o[e](n),{c(){t.c(),s=ne()},m(u,_){f[e].m(u,_),S(u,s,_),l=!0},p(u,_){let D=e;e=b(u,_),e===D?f[e].p(u,_):(x(),$(f[D],1,1,()=>{f[D]=null}),Z(),t=f[e],t||(t=f[e]=o[e](u),t.c()),L(t,1),t.m(s.parentNode,s))},i(u){if(l)return;L(t),l=!0},o(u){$(t),l=!1},d(u){f[e].d(u),u&&g(s)}}}function He(n){let e,t;return e=new ce({props:{type:"primary",size:"small",disabled:!0,$$slots:{default:[qe]},$$scope:{ctx:n}}}),{c(){le(e.$$.fragment)},m(s,l){oe(e,s,l),t=!0},p(s,l){const o={};l&16777216&&(o.$$scope={dirty:l,ctx:s}),e.$set(o)},i(s){if(t)return;L(e.$$.fragment,s),t=!0},o(s){$(e.$$.fragment,s),t=!1},d(s){se(e,s)}}}function We(n){let e,t;function s(...l){return n[13](n[18],...l)}return e=new ce({props:{type:"primary",size:"small",onClick:s,$$slots:{default:[Ge]},$$scope:{ctx:n}}}),{c(){le(e.$$.fragment)},m(l,o){oe(e,l,o),t=!0},p(l,o){n=l;const f={};o&6&&(f.onClick=s),o&16777216&&(f.$$scope={dirty:o,ctx:n}),e.$set(f)},i(l){if(t)return;L(e.$$.fragment,l),t=!0},o(l){$(e.$$.fragment,l),t=!1},d(l){se(e,l)}}}function qe(n){let e;return{c(){e=B(`Processing... file
              will open in a new tab.`)},m(t,s){S(t,e,s)},d(t){t&&g(e)}}}function Ge(n){let e;return{c(){e=B("Download File")},m(t,s){S(t,e,s)},d(t){t&&g(e)}}}function ge(n){let e,t,s,l=(n[18]??"")+"",o,f,b,u=n[7](n[18])+"",_,D,p,d=n[2][n[18]]?.type==="file"&&n[2][n[18]].value&&ke(n);return{c(){e=k("div"),t=k("p"),s=k("strong"),o=B(l),f=h(),b=k("p"),_=B(u),D=h(),d&&d.c(),ie(e,"class","mt-4")},m(c,O){S(c,e,O),a(e,t),a(t,s),a(s,o),a(e,f),a(e,b),a(b,_),a(e,D),d&&d.m(e,null),p=!0},p(c,O){(!p||O&2)&&l!==(l=(c[18]??"")+"")&&I(o,l),(!p||O&2)&&u!==(u=c[7](c[18])+"")&&I(_,u),c[2][c[18]]?.type==="file"&&c[2][c[18]].value?d?(d.p(c,O),O&6&&L(d,1)):(d=ke(c),d.c(),L(d,1),d.m(e,null)):d&&(x(),$(d,1,1,()=>{d=null}),Z())},i(c){if(p)return;L(d),p=!0},o(c){$(d),p=!1},d(c){c&&g(e),d&&d.d()}}}function Ke(n){let e,t,s,l;const o=[Me,Ee],f=[];function b(u,_){return u[3]===Q.Loading?0:1}return e=b(n,-1),t=f[e]=o[e](n),{c(){t.c(),s=ne()},m(u,_){f[e].m(u,_),S(u,s,_),l=!0},p(u,[_]){let D=e;e=b(u,_),e===D?f[e].p(u,_):(x(),$(f[D],1,1,()=>{f[D]=null}),Z(),t=f[e],t||(t=f[e]=o[e](u),t.c()),L(t,1),t.m(s.parentNode,s))},i(u){if(l)return;L(t),l=!0},o(u){$(t),l=!1},d(u){f[e].d(u),u&&g(s)}}}function Ue(n,e,t){let{submission:s}=e,l={},{form:o}=e,{mode:f=""}=e,b=Q.NotStarted,u=!1,_=!1,D="",p=["submission_id"];me(d),Be(d);function d(){t(2,l={}),t(3,b=Q.Loading);try{if(!s)return;Object.keys(s.details).forEach(m=>{let v=N(m);v&&t(2,l[m]=v,l)})}finally{t(3,b=Q.Finished)}}async function c(m){try{t(4,u=!0);const v=m.value.id,F=await Je(`form/${o.id}/submission/file/${v}`,m.value);window.open(F.message)}catch(v){D=v.message}finally{t(4,u=!1)}}function O(m){let v=s?.details[m];return v=Re(m,v)??v,$e(v)||Array.isArray(v)?JSON.stringify(v,null,2):v??""}function N(m){return o.fields.find(v=>v.label===m||v.name===m)}function j(){if(!s)return JSON.stringify({});const m=ee(s);return Object.keys(m.details).forEach(v=>{const F=N(v);if(F){const P=ee(m.details[v]);delete m.details[v],m.details[F.name]=P}}),delete m.details.submission_id,delete m.details["Submission Date"],delete m.newSubmissionKey,JSON.stringify(m,null,4)}Oe(me,m=>{if(!o||!o.fields)return;const v=o.fields.findIndex(P=>P.id===m.id);if(v===-1)return;t(0,o.fields[v].updated=!o.fields[v].updated,o);const F=o.fields.filter(P=>{if(!P.logic||!P.logic.rules)return!1;const E=P.logic.rules.find(R=>R.field===m.id);return E!=null});for(let P of F){let E=o.fields.findIndex(R=>R.id===P.id);t(0,o.fields[E].updated=!o.fields[E].updated,o)}});function J(m){if(!m.logic)return!0;const v=new Ne;return v.evaluate(m)}de("submission_uploading_files",()=>{_=!0}),de("submission_uploading_files_finished",()=>{_=!1});async function H(){t(3,b=Q.Loading);try{await Ae(),t(3,b=Q.Finished)}catch(m){console.error(m),t(3,b=Q.Failed)}}const G=m=>!p.includes(m),z=m=>c(l[m]);return n.$$set=m=>{"submission"in m&&t(1,s=m.submission),"form"in m&&t(0,o=m.form),"mode"in m&&t(11,f=m.mode)},[o,s,l,b,u,p,c,O,j,J,H,f,G,z]}class Qe extends Se{constructor(n){super();he(this,n,Ue,Ke,Pe,{submission:1,form:0,mode:11})}}export default Qe;
