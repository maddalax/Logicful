import{SvelteComponent as F,append as h,attr as T,check_outros as O,create_component as y,destroy_component as C,detach as j,element as v,group_outros as U,init as H,insert as B,mount_component as N,noop as S,safe_not_equal as I,set_style as w,space as A,transition_in as b,transition_out as k}from"../../../../web_modules/svelte/internal.js";import{onMount as P}from"../../../../web_modules/svelte.js";import"./Field.js";import{getUrlParameter as E}from"../../../util/Http.js";import G from"../../../components/DropdownButton.js";import z from"./ContentBlockList.js";import{dispatch as L}from"../../../event/EventBus.js";import"../../../inputs/TextArea.js";import{randomString as M}from"../../../util/Generate.js";import{getApi as J,postApi as $,putApi as K}from"../../../services/ApiService.js";import q from"./ConfigField.js";function Q(r){let t,e,n,i,s;return e=new q({props:{field:{id:`${r[0].id}-name`,type:"string",required:!0,name:"name",label:"Name",placeholder:"Name",value:r[0].name,onChange:r[6]}}}),i=new q({props:{config:{onChange:r[3]},field:{value:r[1],id:M(),name:r[0].name,type:"block-editor"}}}),{c(){t=v("div"),y(e.$$.fragment),n=A(),y(i.$$.fragment),w(t,"margin-top","1em")},m(o,c){B(o,t,c),N(e,t,null),h(t,n),N(i,t,null),s=!0},p(o,c){const d={};c&1&&(d.field={id:`${o[0].id}-name`,type:"string",required:!0,name:"name",label:"Name",placeholder:"Name",value:o[0].name,onChange:o[6]}),e.$set(d);const f={};c&3&&(f.field={value:o[1],id:M(),name:o[0].name,type:"block-editor"}),i.$set(f)},i(o){if(s)return;b(e.$$.fragment,o),b(i.$$.fragment,o),s=!0},o(o){k(e.$$.fragment,o),k(i.$$.fragment,o),s=!1},d(o){o&&j(t),C(e),C(i)}}}function R(r){let t;return{c(){t=v("div"),t.innerHTML='<div class="spinner-border text-secondary" role="status"><span class="sr-only">Loading...</span></div>',w(t,"text-align","center"),w(t,"padding-top","1em"),w(t,"padding-bottom","1em")},m(e,n){B(e,t,n)},p:S,i:S,o:S,d(e){e&&j(t)}}}function V(r){let t,e,n,i,s,o,c;const d=[R,Q],f=[];function _(l,m){return l[0]==null?0:1}return e=_(r,-1),n=f[e]=d[e](r),o=new G({props:{label:"Save",processingLabel:"Saving...",actions:[{label:"Save as Draft",onClick:r[2]},{label:"Save and Publish",onClick:r[2]}]}}),{c(){t=v("div"),n.c(),i=A(),s=v("div"),y(o.$$.fragment),T(s,"class","float-right")},m(l,m){B(l,t,m),f[e].m(t,null),h(t,i),h(t,s),N(o,s,null),c=!0},p(l,[m]){let p=e;e=_(l,m),e===p?f[e].p(l,m):(U(),k(f[p],1,1,()=>{f[p]=null}),O(),n=f[e],n||(n=f[e]=d[e](l),n.c()),b(n,1),n.m(t,i))},i(l){if(c)return;b(n),b(o.$$.fragment,l),c=!0},o(l){k(n),k(o.$$.fragment,l),c=!1},d(l){l&&j(t),f[e].d(),C(o)}}}function W(r,t,e){let n,i,s=!1,o=!1,{id:c}=t,{isNew:d}=t;P(async()=>{d?e(0,n={}):await f()});async function f(){s=!0;const a=await J("content-block"),u=a.find(g=>g.id===c);if(!u)return;e(1,i=await _(u)),e(0,n=u),s=!1}async function _(a){s=!0;try{const u=a.value;if(!u)return[];const g=await fetch(u);return await g.json()}catch(u){return o=!0,[]}finally{s=!1}}async function l(){e(0,n.value=await m(),n),await $("content-block",n),L("option_set_modified",n),L("dialog_show",{child:z,closeOnOutsideClick:!1,confirmCloseOnDirty:!0,title:"Manage Content Blocks"})}async function m(){const a=E("id",n.value),u=a?`?id=${a}`:"",{message:g}=u?await K(`s3/json?${u}`,i):await $(`s3/json?${u}`,i);return g}function p(a){e(1,i=a)}const D=a=>{e(0,n.name=a,n)};return r.$$set=a=>{"id"in a&&e(4,c=a.id),"isNew"in a&&e(5,d=a.isNew)},[n,i,l,p,c,d,D]}class X extends F{constructor(r){super();H(this,r,W,V,I,{id:4,isNew:5})}}export default X;
