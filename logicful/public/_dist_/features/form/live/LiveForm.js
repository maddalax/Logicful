import{SvelteComponent as te,append as b,attr as v,check_outros as z,create_component as N,destroy_component as I,detach as k,element as F,empty as D,group_outros as G,init as ie,insert as h,listen as le,mount_component as R,outro_and_destroy_block as re,prevent_default as oe,safe_not_equal as ne,set_data as P,space as T,text as B,transition_in as S,transition_out as w,update_keyed_each as fe}from"../../../../web_modules/svelte/internal.js";import Q from"./LiveField.js";import{subscribeFieldChange as se}from"../../../event/FieldEvent.js";import"../../../store/FormStore.js";import{LogicBuilder as ue}from"../../../services/LogicBuilder.js";import{fastClone as W}from"../../../util/Compare.js";import{onMount as de}from"../../../../web_modules/svelte.js";import{submitForm as ce}from"./service/SubmitForm.js";import{LoadState as x}from"../../../models/LoadState.js";import"../../../../web_modules/svelte/transition.js";import{subscribeComponent as V}from"../../../event/EventBus.js";import q from"../../../components/Button.js";function X(n,e,i){const t=n.slice();return t[6]=e[i],t}function Y(n){let e,i=(n[0].description??"")+"",t;return{c(){e=F("p"),t=B(i),v(e,"class","text-md text-center text-gray-500 leading-8")},m(l,r){h(l,e,r),b(e,t)},p(l,r){r&1&&i!==(i=(l[0].description??"")+"")&&P(t,i)},d(l){l&&k(e)}}}function ae(n){let e,i,t,l,r;return i=new Q({props:{field:W(n[6]),hidden:!0}}),{c(){e=F("div"),N(i.$$.fragment),t=T(),v(e,"id",l=`form-field-${n[6].id}`)},m(o,a){h(o,e,a),R(i,e,null),b(e,t),r=!0},p(o,a){const g={};a&1&&(g.field=W(o[6])),i.$set(g),(!r||a&1&&l!==(l=`form-field-${o[6].id}`))&&v(e,"id",l)},i(o){if(r)return;S(i.$$.fragment,o),r=!0},o(o){w(i.$$.fragment,o),r=!1},d(o){o&&k(e),I(i)}}}function me(n){let e,i,t,l,r;return i=new Q({props:{field:W(n[6])}}),{c(){e=F("div"),N(i.$$.fragment),t=T(),v(e,"id",l=`form-field-${n[6].id}`)},m(o,a){h(o,e,a),R(i,e,null),b(e,t),r=!0},p(o,a){const g={};a&1&&(g.field=W(o[6])),i.$set(g),(!r||a&1&&l!==(l=`form-field-${o[6].id}`))&&v(e,"id",l)},i(o){if(r)return;S(i.$$.fragment,o),r=!0},o(o){w(i.$$.fragment,o),r=!1},d(o){o&&k(e),I(i)}}}function Z(n,e){let i,t,l,r,o,a;const g=[me,ae],u=[];function _(d,s){return s&1&&(t=!!d[3](d[6])),t?0:1}return l=_(e,-1),r=u[l]=g[l](e),{key:n,first:null,c(){i=D(),r.c(),o=D(),this.first=i},m(d,s){h(d,i,s),u[l].m(d,s),h(d,o,s),a=!0},p(d,s){let y=l;l=_(d,s),l===y?u[l].p(d,s):(G(),w(u[y],1,1,()=>{u[y]=null}),z(),r=u[l],r||(r=u[l]=g[l](d),r.c()),S(r,1),r.m(o.parentNode,o))},i(d){if(a)return;S(r),a=!0},o(d){w(r),a=!1},d(d){d&&k(i),u[l].d(d),d&&k(o)}}}function _e(n){let e,i;return e=new q({props:{type:"primary",disabled:!0,$$slots:{default:[$e]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,l){R(e,t,l),i=!0},p(t,l){const r={};l&512&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){if(i)return;S(e.$$.fragment,t),i=!0},o(t){w(e.$$.fragment,t),i=!1},d(t){I(e,t)}}}function pe(n){let e,i;return e=new q({props:{type:"primary",disabled:!0,$$slots:{default:[he]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,l){R(e,t,l),i=!0},p(t,l){const r={};l&516&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){if(i)return;S(e.$$.fragment,t),i=!0},o(t){w(e.$$.fragment,t),i=!1},d(t){I(e,t)}}}function be(n){let e,i;return e=new q({props:{submit:!0,type:"primary",$$slots:{default:[ye]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,l){R(e,t,l),i=!0},p(t,l){const r={};l&512&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){if(i)return;S(e.$$.fragment,t),i=!0},o(t){w(e.$$.fragment,t),i=!1},d(t){I(e,t)}}}function ge(n){let e,i;return e=new q({props:{submit:!0,type:"primary",$$slots:{default:[Fe]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,l){R(e,t,l),i=!0},p(t,l){const r={};l&512&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){if(i)return;S(e.$$.fragment,t),i=!0},o(t){w(e.$$.fragment,t),i=!1},d(t){I(e,t)}}}function $e(n){let e;return{c(){e=B("Submitted Successfully.")},m(i,t){h(i,e,t)},d(i){i&&k(e)}}}function ve(n){let e;return{c(){e=B("Submitting...")},m(i,t){h(i,e,t)},d(i){i&&k(e)}}}function ke(n){let e;return{c(){e=B("Uploading Files...")},m(i,t){h(i,e,t)},d(i){i&&k(e)}}}function he(n){let e;function i(r,o){return r[2]?ke:ve}let t=i(n,-1),l=t(n);return{c(){l.c(),e=D()},m(r,o){l.m(r,o),h(r,e,o)},p(r,o){t!==(t=i(r,o))&&(l.d(1),l=t(r),l&&(l.c(),l.m(e.parentNode,e)))},d(r){l.d(r),r&&k(e)}}}function ye(n){let e;return{c(){e=B("Failed to Submit, Click To Try Again")},m(i,t){h(i,e,t)},d(i){i&&k(e)}}}function Fe(n){let e;return{c(){e=B("Submit")},m(i,t){h(i,e,t)},d(i){i&&k(e)}}}function Se(n){let e,i,t,l,r=n[0].title+"",o,a,g,u,_,d,s=[],y=new Map,C,E,m,$,M,A,H,p=n[0].description&&Y(n),U=n[0].fields;const J=f=>f[6].id;for(let f=0;f<U.length;f+=1){let c=X(n,U,f),j=J(c);y.set(j,s[f]=Z(j,c))}const K=[ge,be,pe,_e],L=[];function O(f,c){return f[1]===x.NotStarted?0:f[1]===x.Failed?1:f[1]===x.Loading?2:f[1]===x.Finished?3:-1}return~(m=O(n,-1))&&($=L[m]=K[m](n)),{c(){e=F("div"),i=F("div"),t=F("div"),l=F("h2"),o=B(r),a=T(),p&&p.c(),g=T(),u=F("div"),_=F("form"),d=F("div");for(let f=0;f<s.length;f+=1)s[f].c();C=T(),E=F("div"),$&&$.c(),v(l,"class","text-xl text-center font-bold leading-7 text-gray-900 sm:text-3xl sm:leading-9 sm:truncate"),v(t,"class","text-lg max-w-prose mx-auto"),v(d,"id","form-preview-fields"),v(E,"class","pt-2"),v(u,"class","text-gray-500 mx-auto max-w-prose"),v(i,"class","relative px-4 sm:px-6 lg:px-8"),v(e,"class","relative bg-white overflow-visible")},m(f,c){h(f,e,c),b(e,i),b(i,t),b(t,l),b(l,o),b(t,a),p&&p.m(t,null),b(i,g),b(i,u),b(u,_),b(_,d);for(let j=0;j<s.length;j+=1)s[j].m(d,null);b(_,C),b(_,E),~m&&L[m].m(E,null),M=!0,A||(H=le(_,"submit",oe(n[4])),A=!0)},p(f,[c]){if((!M||c&1)&&r!==(r=f[0].title+"")&&P(o,r),f[0].description?p?p.p(f,c):(p=Y(f),p.c(),p.m(t,null)):p&&(p.d(1),p=null),c&9){const ee=f[0].fields;G(),s=fe(s,c,J,1,f,ee,y,d,re,Z,null,X),z()}let j=m;m=O(f,c),m===j?~m&&L[m].p(f,c):($&&(G(),w(L[j],1,1,()=>{L[j]=null}),z()),~m?($=L[m],$||($=L[m]=K[m](f),$.c()),S($,1),$.m(E,null)):$=null)},i(f){if(M)return;for(let c=0;c<U.length;c+=1)S(s[c]);S($),M=!0},o(f){for(let c=0;c<s.length;c+=1)w(s[c]);w($),M=!1},d(f){f&&k(e),p&&p.d();for(let c=0;c<s.length;c+=1)s[c].d();~m&&L[m].d(),A=!1,H()}}}function we(n,e,i){let{form:t}=e,{mode:l=""}=e,r=x.NotStarted,o=!1;se(de,u=>{if(!t||!t.fields)return;const _=t.fields.findIndex(s=>s.id===u.id);if(_===-1)return;i(0,t.fields[_].updated=!t.fields[_].updated,t);const d=t.fields.filter(s=>{if(!s.logic||!s.logic.rules)return!1;const y=s.logic.rules.find(C=>C.field===u.id);return y!=null});for(let s of d){let y=t.fields.findIndex(C=>C.id===s.id);i(0,t.fields[y].updated=!t.fields[y].updated,t)}});function a(u){if(!u.logic)return!0;const _=new ue;return _.evaluate(u)}V("submission_uploading_files",()=>{i(2,o=!0)}),V("submission_uploading_files_finished",()=>{i(2,o=!1)});async function g(){i(1,r=x.Loading);try{await ce(),i(1,r=x.Finished)}catch(u){console.error(u),i(1,r=x.Failed)}}return n.$$set=u=>{"form"in u&&i(0,t=u.form),"mode"in u&&i(5,l=u.mode)},[t,r,o,a,g,l]}class je extends te{constructor(n){super();ie(this,n,we,Se,ne,{form:0,mode:5})}}export default je;
