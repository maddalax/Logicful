import"./RemoteTable.css.proxy.js";import{SvelteComponent as ol,append as s,attr as d,bubble as Ee,check_outros as rl,create_component as Se,destroy_block as sl,destroy_component as Re,destroy_each as Me,detach as T,element as u,empty as De,group_outros as al,init as cl,insert as E,listen as I,mount_component as Fe,run_all as pe,safe_not_equal as fl,set_data as re,set_input_value as Le,set_style as Oe,space as M,stop_propagation as Te,text as K,toggle_class as Q,transition_in as ue,transition_out as me,update_keyed_each as dl}from"../../web_modules/svelte/internal.js";import{afterUpdate as ul,onMount as ml}from"../../web_modules/svelte.js";import _l from"../../web_modules/fusejs.js";import{LoadState as ke}from"../models/LoadState.js";import{randomString as Ae}from"../util/Generate.js";import hl from"./Pagination.js";import{dispatch as je,dispatchPrivate as gl}from"../event/EventBus.js";import{fastClone as pl,fastEquals as Ue}from"../util/Compare.js";import He from"./layout/Dialog.js";import"./ToastManager.js";import{isObject as Pe}from"../guards/Guard.js";function qe(n,l,e){const t=n.slice();return t[62]=l[e],t}function ze(n,l,e){const t=n.slice();return t[62]=l[e],t}function Ve(n,l,e){const t=n.slice();return t[65]=l[e],t[66]=l,t[67]=e,t}function Ne(n,l,e){const t=n.slice();return t[62]=l[e],t}function Be(n){let l,e,t,i,r,c,b,h;return{c(){l=u("div"),e=u("div"),t=u("span"),i=K(n[15]),r=K(" Filter(s) Applied "),c=u("button"),c.innerHTML='<svg class="h-2 w-2" stroke="currentColor" fill="none" viewBox="0 0 8 8"><path stroke-linecap="round" stroke-width="1.5" d="M1 1l6 6m0-6L1 7"></path></svg>',d(c,"type","button"),d(c,"class",`flex-shrink-0 -mr-0.5 ml-1.5 inline-flex
                    text-indigo-500 focus:outline-none focus:text-indigo-700`),d(c,"aria-label","Remove large badge"),d(t,"class",`inline-flex items-center px-3 py-0.5 rounded-full text-sm
                  font-medium leading-5 bg-indigo-100 text-indigo-800`),d(e,"class","text-gray-700 text-center px-4 py-2 m-2")},m(f,S){E(f,l,S),s(l,e),s(e,t),s(t,i),s(t,r),s(t,c),b||(h=I(c,"click",n[39]),b=!0)},p(f,S){S[0]&32768&&re(i,f[15])},d(f){f&&T(l),b=!1,h()}}}function Ie(n){let l,e,t,i,r,c,b,h=n[4].length+"",f,S,D,R,w,L,_,k,C;return{c(){l=u("div"),e=u("span"),t=u("div"),i=K("Selected: "),r=u("strong"),c=K(n[12]),b=K(" of "),f=K(h),S=M(),D=u("span"),D.innerHTML='<div><i class="fas fa-eye"></i></div>',R=M(),w=u("span"),w.innerHTML='<div><i class="fas fa-eye-slash"></i></div>',L=M(),_=u("span"),_.innerHTML='<div><i class="fas fa-trash-alt"></i></div>',d(e,"class","inline-flex rounded-md"),d(D,"class","ml-3 pl-2 inline-flex rounded-md cursor-pointer"),d(w,"class","ml-3 pl-2 inline-flex rounded-md cursor-pointer"),d(_,"class","ml-3 pl-2 inline-flex rounded-md cursor-pointer"),d(l,"class","ml-4 mt-4 flex-shrink-0 flex")},m(F,g){E(F,l,g),s(l,e),s(e,t),s(t,i),s(t,r),s(r,c),s(r,b),s(r,f),s(l,S),s(l,D),s(l,R),s(l,w),s(l,L),s(l,_),k||(C=[I(D,"click",n[40]),I(w,"click",n[41]),I(_,"click",n[42])],k=!0)},p(F,g){g[0]&4096&&re(c,F[12]),g[0]&16&&h!==(h=F[4].length+"")&&re(f,h)},d(F){F&&T(l),k=!1,pe(C)}}}function kl(n){let l;return{c(){l=u("span"),l.innerHTML='<span class="fas fa-chevron-down"></span>'},m(e,t){E(e,l,t)},d(e){e&&T(l)}}}function bl(n){let l;return{c(){l=u("span"),l.innerHTML='<span class="fas fa-chevron-up"></span>'},m(e,t){E(e,l,t)},d(e){e&&T(l)}}}function Ge(n,l){let e,t=l[62]+"",i,r,c,b,h,f,S;function D(_,k){if(_[9]===_[62]&&_[10]==="asc")return bl;if(_[9]===_[62]&&_[10]==="desc")return kl}let R=D(l,[-1]),w=R&&R(l);function L(..._){return l[43](l[62],..._)}return{key:n,first:null,c(){e=u("th"),i=K(t),r=M(),c=u("span"),w&&w.c(),b=M(),d(e,"style",h=l[18](l[62])),d(e,"class",`px-6 py-3 bg-gray-50 text-left text-xs leading-4
                    font-medium text-gray-500 uppercase tracking-wider`),this.first=e},m(_,k){E(_,e,k),s(e,i),s(e,r),s(e,c),w&&w.m(c,null),s(e,b),f||(S=I(e,"click",L),f=!0)},p(_,k){l=_,k[0]&64&&t!==(t=l[62]+"")&&re(i,t),R!==(R=D(l,k))&&(w&&w.d(1),w=R&&R(l),w&&(w.c(),w.m(c,null))),k[0]&64&&h!==(h=l[18](l[62]))&&d(e,"style",h)},d(_){_&&T(e),w&&w.d(),f=!1,S()}}}function Je(n){let l,e,t,i,r,c,b,h,f=W(n[65]),S,D,R,w;function L(...g){return n[44](n[65],...g)}let _=f&&We(n),k=n[6],C=[];for(let g=0;g<k.length;g+=1)C[g]=Ye(ze(n,k,g));function F(...g){return n[45](n[65],n[66],n[67],...g)}return{c(){l=u("tr"),e=u("td"),t=u("div"),i=u("a"),r=u("input"),h=M(),_&&_.c(),S=M();for(let g=0;g<C.length;g+=1)C[g].c();D=M(),d(r,"class",`form-checkbox h-4 w-4 text-indigo-600
                            transition duration-150 ease-in-out`),d(r,"type","checkbox"),r.value="",r.checked=c=n[65].meta_selected,d(r,"id",b="row-toggle-"+n[67]),d(i,"href","#"),d(i,"class","truncate hover:text-gray-600"),d(t,"class","flex items-center space-x-3"),d(e,"class",`px-6 py-3 max-w-0 w-full whitespace-no-wrap text-sm
                      leading-5 font-medium text-gray-900 svelte-z68zu1`),Q(e,"bg-cool-gray-50",!W(n[65])),Oe(l,"vertical-align","middle"),Oe(l,"cursor","pointer"),Q(l,"active",n[65].meta_selected)},m(g,j){E(g,l,j),s(l,e),s(e,t),s(t,i),s(i,r),s(t,h),_&&_.m(t,null),s(l,S);for(let y=0;y<C.length;y+=1)C[y].m(l,null);s(l,D),R||(w=[I(r,"click",Te(n[36])),I(r,"change",Te(L)),I(l,"click",F)],R=!0)},p(g,j){if(n=g,j[0]&16&&c!==(c=n[65].meta_selected)&&(r.checked=c),j[0]&16&&(f=W(n[65])),f?_||(_=We(n),_.c(),_.m(t,null)):_&&(_.d(1),_=null),j[0]&16&&Q(e,"bg-cool-gray-50",!W(n[65])),j[0]&1048656){k=n[6];let y;for(y=0;y<k.length;y+=1){const G=ze(n,k,y);C[y]?C[y].p(G,j):(C[y]=Ye(G),C[y].c(),C[y].m(l,D))}for(;y<C.length;y+=1)C[y].d(1);C.length=k.length}j[0]&16&&Q(l,"active",n[65].meta_selected)},d(g){g&&T(l),_&&_.d(),Me(C,g),R=!1,pe(w)}}}function We(n){let l;return{c(){l=u("div"),d(l,"class",`flex-shrink-0 w-2.5 h-2.5 rounded-full
                            bg-indigo-400`)},m(e,t){E(e,l,t)},d(e){e&&T(l)}}}function Ye(n){let l,e,t=n[20](n[65],n[62])+"",i;return{c(){l=u("td"),e=u("div"),i=K(t),d(e,"class","text svelte-z68zu1"),Q(e,"text-unread",W(n[65])),d(l,"class","px-6 py-4 text-sm leading-5 text-gray-500 svelte-z68zu1"),Q(l,"bg-cool-gray-50",!W(n[65])),Q(l,"font-bold",W(n[65])),Q(l,"text-gray-800",W(n[65]))},m(r,c){E(r,l,c),s(l,e),s(e,i)},p(r,c){c[0]&80&&t!==(t=r[20](r[65],r[62])+"")&&re(i,t),c[0]&16&&Q(e,"text-unread",W(r[65])),c[0]&16&&Q(l,"bg-cool-gray-50",!W(r[65])),c[0]&16&&Q(l,"font-bold",W(r[65])),c[0]&16&&Q(l,"text-gray-800",W(r[65]))},d(r){r&&T(l)}}}function Ke(n){let l,e=n[67]>=n[8].min&&n[67]<=n[8].max&&Je(n);return{c(){e&&e.c(),l=De()},m(t,i){e&&e.m(t,i),E(t,l,i)},p(t,i){t[67]>=t[8].min&&t[67]<=t[8].max?e?e.p(t,i):(e=Je(t),e.c(),e.m(l.parentNode,l)):e&&(e.d(1),e=null)},d(t){e&&e.d(t),t&&T(l)}}}function wl(n){let l,e;return l=new He({props:{title:"Manage Filters",isOpen:!0,onClose:n[51],$$slots:{default:[yl]},$$scope:{ctx:n}}}),{c(){Se(l.$$.fragment)},m(t,i){Fe(l,t,i),e=!0},p(t,i){const r={};i[0]&8192&&(r.onClose=t[51]),i[0]&16384|i[2]&1024&&(r.$$scope={dirty:i,ctx:t}),l.$set(r)},i(t){if(e)return;ue(l.$$.fragment,t),e=!0},o(t){me(l.$$.fragment,t),e=!1},d(t){Re(l,t)}}}function Cl(n){let l,e;return l=new He({props:{title:"Confirm Deletion",isOpen:!0,actions:[{label:`Delete ${n[12]} Entries`,type:"danger",onClick:n[24]},{label:"Cancel",type:"secondary"}],onClose:n[49],$$slots:{default:[Sl]},$$scope:{ctx:n}}}),{c(){Se(l.$$.fragment)},m(t,i){Fe(l,t,i),e=!0},p(t,i){const r={};i[0]&4096&&(r.actions=[{label:`Delete ${t[12]} Entries`,type:"danger",onClick:t[24]},{label:"Cancel",type:"secondary"}]),i[0]&8192&&(r.onClose=t[49]),i[0]&4096|i[2]&1024&&(r.$$scope={dirty:i,ctx:t}),l.$set(r)},i(t){if(e)return;ue(l.$$.fragment,t),e=!0},o(t){me(l.$$.fragment,t),e=!1},d(t){Re(l,t)}}}function vl(n){let l,e;return l=new He({props:{title:"Toggle Column Visibility",isOpen:!0,onClose:n[48],$$slots:{default:[Rl]},$$scope:{ctx:n}}}),{c(){Se(l.$$.fragment)},m(t,i){Fe(l,t,i),e=!0},p(t,i){const r={};i[0]&8192&&(r.onClose=t[48]),i[0]&34|i[2]&1024&&(r.$$scope={dirty:i,ctx:t}),l.$set(r)},i(t){if(e)return;ue(l.$$.fragment,t),e=!0},o(t){me(l.$$.fragment,t),e=!1},d(t){Re(l,t)}}}function yl(n){let l,e,t,i,r,c;return{c(){l=u("div"),e=u("input"),t=M(),i=u("label"),i.textContent="Only Show Unread Items",d(e,"class","form-check-input"),d(e,"type","checkbox"),d(i,"class","form-check-label"),d(l,"class","form-check")},m(b,h){E(b,l,h),s(l,e),e.checked=n[14].onlyUnread,s(l,t),s(l,i),r||(c=[I(e,"change",n[50]),I(e,"click",Te(n[35]))],r=!0)},p(b,h){h[0]&16384&&(e.checked=b[14].onlyUnread)},d(b){b&&T(l),r=!1,pe(c)}}}function Sl(n){let l,e,t,i;return{c(){l=u("p"),e=K("Are you sure you want to delete "),t=K(n[12]),i=K(" entries?")},m(r,c){E(r,l,c),s(l,e),s(l,t),s(l,i)},p(r,c){c[0]&4096&&re(t,r[12])},d(r){r&&T(l)}}}function Qe(n){let l,e,t,i,r,c,b,h,f=n[62]+"",S,D,R,w,L;function _(...k){return n[47](n[62],...k)}return{c(){l=u("div"),e=u("div"),t=u("div"),i=u("input"),c=M(),b=u("div"),h=u("label"),S=K(f),R=M(),d(i,"class",`form-checkbox h-4 w-4 text-indigo-600 transition
                  duration-150 ease-in-out`),d(i,"type","checkbox"),i.checked=r=!n[1].has(n[62]),d(t,"class","flex items-center h-5"),d(h,"for",D="toggle-"+n[62]),d(h,"class","font-medium text-gray-700"),d(b,"class","ml-3 text-sm leading-5"),d(e,"class","relative flex items-start"),d(l,"class","mt-4")},m(k,C){E(k,l,C),s(l,e),s(e,t),s(t,i),s(e,c),s(e,b),s(b,h),s(h,S),s(l,R),w||(L=[I(i,"click",Te(n[34])),I(i,"change",_)],w=!0)},p(k,C){n=k,C[0]&34&&r!==(r=!n[1].has(n[62]))&&(i.checked=r),C[0]&32&&f!==(f=n[62]+"")&&re(S,f),C[0]&32&&D!==(D="toggle-"+n[62])&&d(h,"for",D)},d(k){k&&T(l),w=!1,pe(L)}}}function Xe(n){let l,e=n[62]!=="table_meta_id"&&Qe(n);return{c(){e&&e.c(),l=De()},m(t,i){e&&e.m(t,i),E(t,l,i)},p(t,i){t[62]!=="table_meta_id"?e?e.p(t,i):(e=Qe(t),e.c(),e.m(l.parentNode,l)):e&&(e.d(1),e=null)},d(t){e&&e.d(t),t&&T(l)}}}function Rl(n){let l,e=n[5],t=[];for(let i=0;i<e.length;i+=1)t[i]=Xe(qe(n,e,i));return{c(){for(let i=0;i<t.length;i+=1)t[i].c();l=De()},m(i,r){for(let c=0;c<t.length;c+=1)t[c].m(i,r);E(i,l,r)},p(i,r){if(r[0]&2097186){e=i[5];let c;for(c=0;c<e.length;c+=1){const b=qe(i,e,c);t[c]?t[c].p(b,r):(t[c]=Xe(b),t[c].c(),t[c].m(l.parentNode,l))}for(;c<t.length;c+=1)t[c].d(1);t.length=e.length}},d(i){Me(t,i),i&&T(l)}}}function Dl(n){let l,e,t,i,r,c,b,h,f,S,D,R,w,L,_,k,C,F,g,j,y,G,V,ie,le,Y,be,se,J=[],X=new Map,ae,x,oe,$,_e,H,N,ee,te,ce,we,U=n[15]>0&&Be(n),O=n[12]>0&&Ie(n),he=n[6];const fe=a=>a[62];for(let a=0;a<he.length;a+=1){let v=Ne(n,he,a),A=fe(v);X.set(A,J[a]=Ge(A,v))}let ne=n[4],P=[];for(let a=0;a<ne.length;a+=1)P[a]=Ke(Ve(n,ne,a));$=new hl({props:{id:n[3],count:n[4].length,onRangeChange:n[46]}});const Ce=[vl,Cl,wl],Z=[];function ve(a,v){return a[13]==="toggle_column"?0:a[13]==="delete"?1:a[13]==="filter"?2:-1}return~(H=ve(n,[-1]))&&(N=Z[H]=Ce[H](n)),{c(){l=u("div"),e=u("div"),t=u("div"),i=u("div"),r=u("div"),c=u("div"),b=u("div"),b.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>',h=M(),f=u("input"),S=M(),D=u("div"),R=u("div"),w=u("div"),w.innerHTML='<i class="fas fa-filter"></i>',L=M(),U&&U.c(),_=M(),O&&O.c(),k=M(),C=u("div"),F=u("div"),g=u("div"),j=u("div"),y=u("table"),G=u("thead"),V=u("tr"),ie=u("th"),le=u("div"),Y=u("input"),se=M();for(let a=0;a<J.length;a+=1)J[a].c();ae=M(),x=u("tbody");for(let a=0;a<P.length;a+=1)P[a].c();oe=M(),Se($.$$.fragment),_e=M(),N&&N.c(),ee=De(),d(b,"class",`absolute inset-y-0 left-0 pl-3 flex items-center
                pointer-events-none`),d(f,"class","form-input block w-full pl-10 sm:text-sm sm:leading-5"),d(f,"placeholder",n[0]),d(c,"class","mt-1 relative rounded-md shadow-sm"),d(r,"class","flex-shrink-0"),d(R,"class","text-gray-700 text-center px-4 py-2 m-2"),d(i,"class","flex items-center"),d(e,"class",`-ml-4 -mt-4 flex justify-between items-center flex-wrap
      sm:flex-no-wrap`),d(l,"class","bg-white px-4 py-5 border-b border-gray-200 sm:px-6"),d(Y,"class",`form-checkbox h-4 w-4 text-indigo-600 transition
                      duration-150 ease-in-out`),d(Y,"type","checkbox"),Y.value="",Y.checked=n[11],d(Y,"id",be="row-toggle-all"),d(ie,"class",`px-6 py-3 bg-gray-50 text-left text-xs leading-4
                  font-medium text-gray-500 uppercase tracking-wider`),d(x,"class","divide-y divide-gray-200"),d(y,"class","min-w-full divide-y divide-gray-200 table-fixed"),d(j,"class","shadow overflow-hidden border-b border-gray-200 sm:rounded-lg"),d(g,"class","py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8"),d(F,"class","-my-2 overflow-x-scroll sm:-mx-6 lg:-mx-8"),d(C,"class","flex flex-col")},m(a,v){E(a,l,v),s(l,e),s(e,t),s(t,i),s(i,r),s(r,c),s(c,b),s(c,h),s(c,f),Le(f,n[7]),s(i,S),s(i,D),s(D,R),s(R,w),s(i,L),U&&U.m(i,null),s(e,_),O&&O.m(e,null),E(a,k,v),E(a,C,v),s(C,F),s(F,g),s(g,j),s(j,y),s(y,G),s(G,V),s(V,ie),s(ie,le),s(le,Y),s(V,se);for(let A=0;A<J.length;A+=1)J[A].m(V,null);s(y,ae),s(y,x);for(let A=0;A<P.length;A+=1)P[A].m(x,null);E(a,oe,v),Fe($,a,v),E(a,_e,v),~H&&Z[H].m(a,v),E(a,ee,v),te=!0,ce||(we=[I(f,"input",n[37]),I(w,"click",n[38]),I(Y,"change",n[16])],ce=!0)},p(a,v){if((!te||v[0]&1)&&d(f,"placeholder",a[0]),v[0]&128&&f.value!==a[7]&&Le(f,a[7]),a[15]>0?U?U.p(a,v):(U=Be(a),U.c(),U.m(i,null)):U&&(U.d(1),U=null),a[12]>0?O?O.p(a,v):(O=Ie(a),O.c(),O.m(e,null)):O&&(O.d(1),O=null),(!te||v[0]&2048)&&(Y.checked=a[11]),v[0]&394816){const q=a[6];J=dl(J,v,fe,1,a,q,X,V,sl,Ge,null,Ne)}if(v[0]&5243220){ne=a[4];let q;for(q=0;q<ne.length;q+=1){const ye=Ve(a,ne,q);P[q]?P[q].p(ye,v):(P[q]=Ke(ye),P[q].c(),P[q].m(x,null))}for(;q<P.length;q+=1)P[q].d(1);P.length=ne.length}const A={};v[0]&8&&(A.id=a[3]),v[0]&16&&(A.count=a[4].length),v[0]&288&&(A.onRangeChange=a[46]),$.$set(A);let ge=H;H=ve(a,v),H===ge?~H&&Z[H].p(a,v):(N&&(al(),me(Z[ge],1,1,()=>{Z[ge]=null}),rl()),~H?(N=Z[H],N||(N=Z[H]=Ce[H](a),N.c()),ue(N,1),N.m(ee.parentNode,ee)):N=null)},i(a){if(te)return;ue($.$$.fragment,a),ue(N),te=!0},o(a){me($.$$.fragment,a),me(N),te=!1},d(a){a&&T(l),U&&U.d(),O&&O.d(),a&&T(k),a&&T(C);for(let v=0;v<J.length;v+=1)J[v].d();Me(P,a),a&&T(oe),Re($,a),a&&T(_e),~H&&Z[H].d(a),a&&T(ee),ce=!1,pe(we)}}}function W(n){return n.meta_unread===!0}function Fl(n,l,e){let{getRows:t}=l,{defaultSortColumn:i=""}=l,{searchPlaceHolder:r="Search"}=l,{columnMeta:c={}}=l,b="",h=[],f=[],S=[],D=[],R="",w,L=ke.Loading,_={min:1,max:1},k={},C,F="",g="",j=!1,y=0,G="",V={onlyUnread:!1},ie={},le=0,{headerActions:Y=[]}=l,{onEdit:be=void 0}=l,{onDelete:se=void 0}=l,{onRead:J=void 0}=l,{hidden:X=new Set}=l,{sortColumns:ae=void 0}=l,{onFormat:x=()=>{}}=l,{onRowClick:oe=()=>{}}=l;ul(()=>{console.log("after update",V),Ue(V,ie)||(ie=pl(V),$())});function $(){e(15,le=0),e(4,f=h),V.onlyUnread&&(e(15,le++,le),e(4,f=f.filter(o=>W(o))))}function _e(){const o=h.map(m=>{const p={};return Object.keys(m).forEach(z=>{p[z]=Pe(m[z])?JSON.stringify(m[z]):m[z]}),p});return new _l(o,{keys:Object.keys(h[0])})}ml(()=>{e(3,b=Ae()),X.add("table_meta_id");const o=document.createElement("canvas");C=o.getContext("2d"),N()});function H(){for(let m=0;m<f.length;m++)m>=_.min&&m<=_.max&&e(4,f[m].meta_selected=!j,f);e(11,j=!j);let o=0;for(let m=0;m<f.length;m++)f[m].meta_selected&&o++;e(12,y=o)}async function N(){try{if(L=ke.Loading,e(52,h=await t()),h.length===0){L=ke.Finished;return}h.map(m=>(m.table_meta_id=Ae(),m)),e(53,w=_e()),e(4,f=h);let o=new Set;h.forEach(m=>{Object.keys(m).forEach(p=>o.add(p))}),e(5,S=Array.from(o)),e(5,S=ae?.(S)??S),e(6,D=S.filter(m=>!X.has(m))),L=ke.Finished,i&&ee(i)}catch(o){console.error(o),L=ke.Failed}}function ee(o){F===o?(e(9,F=o),e(10,g=g==="asc"?"desc":"asc")):(e(9,F=o),e(10,g="desc"));let m=c[o]?.type==="date";gl(b,"on_sort",{sort:F,sortDirection:g}),e(4,f=f.sort(function(p,z){var B=p[F]?.toString()?.toUpperCase(),de=z[F]?.toString()?.toUpperCase();if(B==null&&de==null)return 0;if(B==null)return 1;if(de==null)return 1;if(m){if(new Date(B).getTime()<new Date(de).getTime())return 1;if(new Date(B).getTime()>new Date(de).getTime())return-1}return B<de?1:B>de?-1:0})),g==="asc"&&e(4,f=f.reverse())}function te(o){if(k[o])return"width: "+k[o]+"px;"}function ce(){let o=f.slice(_.min,_.max);k={},o.forEach(m=>{S.forEach(p=>{const z=m[p];let B=U(z,"");B<150&&(B=150),B>400&&(B=400),(k[p]??0)<B&&(k[p]=B)})})}function we(o,m){let p=o[m]??"";return p=x(m,o[m])??p,Pe(p)||Array.isArray(p)?JSON.stringify(p):p}function U(o,m){return C.font="bold 1em arial",C.measureText(o).width}function O(o,m){o?X.delete(m):X.add(m),e(6,D=S.filter(p=>!X.has(p)))}function he(o){const m=f.findIndex(p=>p.table_meta_id===o.table_meta_id);f[m].meta_selected?(e(12,y--,y),e(4,f[m].meta_selected=!1,f)):(e(12,y++,y),e(4,f[m].meta_selected=!0,f))}async function fe(o){const m=f.filter(z=>z.meta_selected),p=new Set(m.map(z=>z.table_meta_id));await J?.(m,o),e(4,f=f.map(z=>{const B=z.table_meta_id;return p.has(B)&&(z.meta_unread=!o),z})),je("show_toast",{message:`Item(s) marked as ${o?"read":"unread"}.`})}async function ne(){const o=f.filter(p=>p.meta_selected);if(o.length!==y)throw new Error("Selection count did not match actual selected, please try reloading the page.");await se?.(o),je("show_toast",{title:"Deletion Started",message:"Your entries have been queued for deletion."}),e(13,G="");const m=new Set(o.map(p=>p.table_meta_id));e(4,f=f.filter(p=>!m.has(p.table_meta_id))),e(4,f=f.map(p=>(p.meta_selected=!1,p))),e(52,h=h.filter(p=>!m.has(p.table_meta_id))),je("show_toast",{message:"Item(s) deleted.'}."})}function P(o){Ee(n,o)}function Ce(o){Ee(n,o)}function Z(o){Ee(n,o)}function ve(){R=this.value,e(7,R)}const a=()=>e(13,G="filter"),v=()=>{e(14,V={})},A=()=>fe(!0),ge=()=>fe(!1),q=()=>e(13,G="delete"),ye=o=>ee(o),Ze=(o,m)=>{he(o)},xe=(o,m,p)=>{oe(o),e(4,m[p].meta_unread=!1,f)},$e=o=>{if(Ue(o,_))return;e(8,_=o),ce(),e(5,S)},el=(o,m)=>{O(m.target.checked,o)},ll=()=>{e(13,G="")},tl=()=>{e(13,G="")};function nl(){V.onlyUnread=this.checked,e(14,V)}const il=()=>{e(13,G="")};return n.$$set=o=>{"getRows"in o&&e(25,t=o.getRows),"defaultSortColumn"in o&&e(26,i=o.defaultSortColumn),"searchPlaceHolder"in o&&e(0,r=o.searchPlaceHolder),"columnMeta"in o&&e(27,c=o.columnMeta),"headerActions"in o&&e(28,Y=o.headerActions),"onEdit"in o&&e(29,be=o.onEdit),"onDelete"in o&&e(30,se=o.onDelete),"onRead"in o&&e(31,J=o.onRead),"hidden"in o&&e(1,X=o.hidden),"sortColumns"in o&&e(32,ae=o.sortColumns),"onFormat"in o&&e(33,x=o.onFormat),"onRowClick"in o&&e(2,oe=o.onRowClick)},n.$$.update=()=>{if(n.$$.dirty[0]&128|n.$$.dirty[1]&6291456){e:if(h.length===0)e(4,f=h);else if(R==="")e(4,f=h);else{const o=w.search(R);e(4,f=o.map(m=>m.item))}}},[r,X,oe,b,f,S,D,R,_,F,g,j,y,G,V,le,H,ee,te,ce,we,O,he,fe,ne,t,i,c,Y,be,se,J,ae,x,P,Ce,Z,ve,a,v,A,ge,q,ye,Ze,xe,$e,el,ll,tl,nl,il]}class Tl extends ol{constructor(n){super();cl(this,n,Fl,Dl,fl,{getRows:25,defaultSortColumn:26,searchPlaceHolder:0,columnMeta:27,headerActions:28,onEdit:29,onDelete:30,onRead:31,hidden:1,sortColumns:32,onFormat:33,onRowClick:2},[-1,-1,-1])}}export default Tl;
