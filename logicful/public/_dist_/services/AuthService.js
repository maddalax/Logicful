import{postApi as l}from"./ApiService.js";let o="",n=!1;export function setToken(e,t=!0){if(!localStorage)return;localStorage.removeItem("token"),t?localStorage.setItem("token",JSON.stringify(e)):o=JSON.stringify(e)}export async function getToken(){if(!localStorage)return;const e=localStorage.getItem("token")??o;if(!e)return;try{let t=JSON.parse(e);const r=t.expiration-Date.now();return r<=0?(await a(),await getToken()):(r<=864e5&&a(),t.token)}catch(t){localStorage.removeItem("token"),o="";return}}export async function me(){const e={fullName:"",displayName:"",email:"",id:"",teamId:""},t=await getToken();if(!t)return e;try{const r=c(t);return r}catch{return e}}function c(e){var t=e.split(".")[1],r=t.replace(/-/g,"+").replace(/_/g,"/"),i=decodeURIComponent(atob(r).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(i)}async function a(){if(n)return;n=!0;try{const e=await l("user/refresh",{});setToken(e,!0)}finally{n=!1}}
