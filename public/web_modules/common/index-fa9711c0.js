import{E as f,s as _,F as x,G as S,H as q}from"./index-8f6da9e5.js";const c=[];function w(s,a){return{subscribe:h(s,a).subscribe}}function h(s,a=f){let o;const n=[];function l(e){if(_(s,e)&&(s=e,o)){const r=!c.length;for(let t=0;t<n.length;t+=1){const i=n[t];i[1](),c.push(i,s)}if(r){for(let t=0;t<c.length;t+=2)c[t][0](c[t+1]);c.length=0}}}function p(e){l(e(s))}function b(e,r=f){const t=[e,r];return n.push(t),n.length===1&&(o=a(l)||f),e(s),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1),n.length===0&&(o(),o=null)}}return{set:l,update:p,subscribe:b}}function A(s,a,o){const n=!Array.isArray(s),l=n?[s]:s,p=a.length<2;return w(o,b=>{let e=!1;const r=[];let t=0,i=f;const g=()=>{if(t)return;i();const u=a(n?r[0]:r,b);p?b(u):i=q(u)?u:f},m=l.map((u,d)=>x(u,y=>{r[d]=y,t&=~(1<<d),e&&g()},()=>{t|=1<<d}));return e=!0,g(),function(){S(m),i()}})}export{A as d,h as w};
